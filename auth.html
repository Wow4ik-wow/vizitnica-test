<script>
    let accounts = [];

    function initGoogleAuth() {
        // Показываем кастомный список аккаунтов
        showCustomAccountsList();
        
        // One-Tap на всякий случай
        google.accounts.id.initialize({
            client_id: "1060687932793-sk24egn7c7r0h6t6i1dedk4u6hrgdotc.apps.googleusercontent.com",
            callback: handleAuthResponse,
            auto_select: false,
            ux_mode: "popup"
        });
        google.accounts.id.prompt();
    }

    function showCustomAccountsList() {
        // Здесь будет кастомный список аккаунтов
        // Нужно получить доступ к Google API для списка аккаунтов
        console.log('Показываем кастомный список');
        
        // Заглушка - показываем сообщение
        document.getElementById('googleButton').innerHTML = `
            <div style="text-align: center; padding: 20px;">
                <p style="color: #666; margin-bottom: 20px;">Выберите способ входа:</p>
                <button onclick="google.accounts.id.prompt()" style="background: #4285f4; color: white; border: none; padding: 15px 20px; border-radius: 5px; cursor: pointer; width: 100%;">
                    Войти через Google
                </button>
            </div>
        `;
    }

    function handleAuthResponse(response) {
        if (response.credential) {
            localStorage.setItem('googleAuthCredential', response.credential);
            localStorage.setItem('googleAuthTimestamp', Date.now());
            
            try {
                if (window.opener && !window.opener.closed) {
                    window.opener.postMessage({
                        type: 'GOOGLE_AUTH_SUCCESS',
                        credential: response.credential
                    }, '*');
                }
            } catch (e) {}
            
            window.close();
        }
    }

    window.addEventListener('load', function() {
        setTimeout(initGoogleAuth, 100);
    });
</script>